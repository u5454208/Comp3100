define("wixCode/utils/wixCodeWidgetService",["lodash","wixCodeInit"],function(a,b){"use strict";function c(a){return b.specMapUtils.getAppSpec(a)}function d(a){return!!c(a)}return{hasWixCodeWidgetSpecs:d,getWixCodeSpec:c}}),define("wixCode/aspects/WixCodeWidgetAspect",["lodash"],function(a){"use strict";function b(a){this._aspectSiteAPI=a}return b.prototype={initApp:function(){var b=this._aspectSiteAPI.getSiteData(),c=this._aspectSiteAPI.getWixCodeAppApi();c.init(b,b.getClientSpecMap(),{isMobileView:b.isMobileView(),debug:b.isDebugMode(),sdkSource:a.get(b,["currentUrl","query","sdkSource"]),runtimeSource:a.get(b,["currentUrl","query","WixCodeRuntimeSource"])})}},b}),define("wixCode/handlers/wixCodeHandlers",["lodash","utils"],function(a,b){"use strict";var c=function(a){switch(a.link.type){case"PageLink":return"PAGE";case"ExternalLink":case"EmailLink":case"AnchorLink":case"DocumentLink":return"LINK"}},d=function(b){switch(b.link.type){case"PageLink":return"/"+b.link.pageId.pageUriSEO;case"ExternalLink":return b.link.url;case"AnchorLink":var c=function(b){switch(b){case"SCROLL_TO_BOTTOM":return"#bottom";case"SCROLL_TO_TOP":return"#top";default:return a.isObject(b)?"#"+b.id:b}},d=b.link.pageId.pageUriSEO?"/"+b.link.pageId.pageUriSEO:"",e=b.link.anchorDataId?c(b.link.anchorDataId):"";return d+e;case"DocumentLink":return"document://"+b.link.docId;case"EmailLink":return"mailto:"+b.link.recipient}},e=function(b){return a.map(b,function(b){var f={$type:"HEADER",title:b.label||"",children:e(b.items)};return b.link&&a.assign(f,{$type:c(b),url:d(b)}),f})},f=function(a,c,d){var f=b.menuUtils.getSiteMenuWithoutRenderedLinks(a.getSiteData(),!1);d(e(f))},g=function(a,b,c){c(a.getSiteData().getCurrentUrl())},h=function(a,b){return a.getSiteData().findDataOnMasterPageByPredicate(function(a){return a.pageUriSEO===b||a.id===b})},i=function(a,b){var c=a.getSiteData(),d=c.renderFlags.isExternalNavigationAllowed;if(!b||!d){var e=c.renderRealtimeConfig.previewTooltipCallback;return void e(j(50,20),"text_editor_inactive_link_on_preview")}window.location.href=b},j=function(a,b){var e,f,c=void 0!==window.screenLeft?window.screenLeft:window.screen.left,d=void 0!==window.screenTop?window.screenTop:window.screen.top;e=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,f=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height;var g=e/2-a/2+c,h=f/2-b/2+d;return{top:h,left:g}},k=function(b,c){"ExternalLink"===c.data.type&&i(b,c.data.url);var d={pageId:b.getSiteData().getPrimaryPageId()};if(c.data.pageId)if("#"===c.data.pageId)a.assign(d,{pageId:b.getSiteData().getMainPageId()});else{var e=h(b,c.data.pageId);a.assign(d,{pageId:"masterPage"===e.id?d.pageId:e.id})}c.data.anchorDataId&&a.assign(d,{anchorData:c.data.anchorDataId}),b.handleNavigation(d,"#",!0)},l=function(a,b,c){c({window:a.getWindowSize(),scroll:a.getSiteScroll(),document:a.getDocumentSize()})};return{windowBoundingRect:l,navigateTo:k,getSiteMenu:f,getFullPageUrl:g}}),define("wixCode/services/wixCodeAppsAPIService",["lodash"],function(a){"use strict";var b={},c=function(c,d,e,f){a.get(b,c)&&b[c][d].apply(null,e).then(function(a){f(a)})},d=function(a,c){b[a]=c};return{invokeAppFunctionFor:c,setAppAPI:d}}),define("wixCode/utils/wixCodeWindowGlobal",[],function(){"use strict";return"undefined"!=typeof window&&window}),define("wixCode/utils/constants",[],function(){"use strict";return{MESSAGE_INTENT:{WIX_CODE_MESSAGE:"WIX_CODE",WIX_CODE_SITE_API:"WIX_CODE_SITE_API",WIX_CODE_APP_API:"WIX_CODE_APP_API"},MESSAGE_TYPE:{CONSOLE:"console",IFRAME_COMMAND:"wix_code_iframe_command",GOOGLE_ANALYTICS:"googleAnalytics"}}}),define("wixCode/utils/messageBuilder",["lodash","wixCode/utils/constants"],function(a,b){"use strict";function c(a,b){return"load_widgets"===a.type?{appConfig:{scari:b.appRenderInfo}}:void 0}function d(d,e){var f={intent:b.MESSAGE_INTENT.WIX_CODE_MESSAGE};if(d.widgets){var g=c(d,e);d.widgets=a.map(d.widgets,function(b){return"Application"===b.type?b:a.assign({},b,g)})}return a.defaults({},d,f)}return{getExtendedMessage:d}}),define("wixCode/aspects/wixCodePostMessageService",["lodash","pmrpc","tpa","utils","wixCode/handlers/wixCodeHandlers","wixCode/services/wixCodeAppsAPIService","wixCode/utils/wixCodeWindowGlobal","wixCode/utils/constants","wixCode/utils/messageBuilder","widgets"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){return a===h.MESSAGE_INTENT.WIX_CODE_MESSAGE}function l(a){return a===h.MESSAGE_INTENT.WIX_CODE_SITE_API}function m(a){return a===h.MESSAGE_INTENT.WIX_CODE_APP_API}function n(a){return j.widgetService.getWidgetHandler(a)}function o(a){g.parent&&g.parent!==g&&g.parent.postMessage(JSON.stringify(a),"*")}function p(a,b,c){var e=n(a);switch(b.type){case h.MESSAGE_TYPE.IFRAME_COMMAND:e.onCommand(b,c);break;case h.MESSAGE_TYPE.CONSOLE:o(b);break;case h.MESSAGE_TYPE.GOOGLE_ANALYTICS:d.logger.reportGoogleAnalytics.apply(null,[a.getSiteData()].concat(b.data));break;default:e.handleRemoteMessage(b)}}function q(d,e,g){var h=a.get(e.data,"compId"),i=d.getComponentById(h);if(!i)throw new Error("No component found for message",e.data);switch(e.type){case"invokeAppFn":f.invokeAppFunctionFor(h,e.data.fn,e.data.fnArgs,g);break;case"getAppAPI":b.api.get({appId:h,initiator:h+"iframe"}).then(function(a){f.setAppAPI(h,a),g(Object.keys(a))});var j=i.getIframe();if(!j)throw new Error("No iframe found for component",i);c.common.tpaPostMessageCommon.callPostMessage(j,{getAPI:!0,compId:h})}}function r(b,d,f){try{a.isString(d)&&(d=JSON.parse(d))}catch(g){return}if(d)if(k(d.intent))f(d,s(d,n(b)));else if(l(d.intent)){var h=a.assign({},c.tpaHandlers,e);h[d.type]&&h[d.type](b,d,s(d,n(b)))}else m(d.intent)&&q(b,d,s(d,n(b)))}function s(b,c){return function(d){var e={intent:"WIX_CODE_RESPONSE",callbackId:b.callbackId,type:b.type,contextId:b.contextId};e=l(b.intent)||m(b.intent)?a.merge(e,{result:d}):a.merge(e,{result:{compName:b.compName,command:b.command}});try{c.updateComponent(e)}catch(f){}}}function t(b,c,d){r(b,c,d||a.partial(p,b))}function u(b,c){var d=a.get(b.getSiteData(),["rendererModel","wixCodeModel"]);return i.getExtendedMessage(c,d)}function v(b,c){j.widgetService.registerWidgetMessageHandler(b,a.partial(c,b))}function w(b,c){j.widgetService.registerWidgetMessageModifier(b,a.partial(c,b))}return{handleMessage:t,modifyPostMessage:u,registerMessageHandler:v,registerMessageModifier:w}}),define("wixCode/aspects/WixCodePostMessageAspect",["wixCode/aspects/wixCodePostMessageService"],function(a){"use strict";return function(c){this.siteAPI=c,a.registerMessageHandler(this.siteAPI,a.handleMessage),a.registerMessageModifier(this.siteAPI,a.modifyPostMessage)}}),define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect"],function(a,b,c){"use strict";var d=a.siteAspectsRegistry;d.registerSiteAspect("wixCodeWidgetAspect",b),d.registerSiteAspect("wixCodePostMessageAspect",c)}),define("wixCode/utils/kibanaReporter",["lodash","utils"],function(b,c){"use strict";function e(a,d){var e=b.clone(a);e=f(e);var g={protocol:"http:",hostname:"monitoringhub."+d,path:"/logstash/events/gost",query:e,hash:""},h=c.urlUtils.buildFullUrl(g),i=new window.Image(0,0);i.src=h}function f(a){var c=b.clone(a);b.isError(c.message)&&(c.message=c.message.stack),c.hasOwnProperty("message")&&!b.isString(c.message)&&(c.message=JSON.stringify(c.message));var d={message:512};return b.forEach(d,function(d,e){b.isString(a[e])&&(c[e]=c[e].substr(0,Math.min(c[e].length,d)))}),c}function g(){return{source:"wix-code-client",level:d.INFO,userActionId:c.guidUtils.getGUID()}}function h(a){if(!b.isString(a)||0===a.length)throw new Error("parameter `baseDomain` is invalid, received: "+a)}function i(a,c){h(c);var d=new Date,f=d.getTime(),i=b.assign({},g(),a,{timestamp:d.toJSON(),actionPosition:"start"});return e(i,c),function(a){var d=new Date,g=d.getTime(),h=(g-f)/1e3;a=b.assign({},i,a,{timestamp:d.toJSON(),duration:h,actionPosition:"end"}),e(a,c)}}var d={INFO:"info",ERROR:"error"};return{levels:d,trace:i}}),define("wixCode",["wixCode/utils/wixCodeWidgetService","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/messageBuilder","wixCode/utils/kibanaReporter","wixCode/aspects/wixCodePostMessageService"],function(a,b,c,d,e){"use strict";return{wixCodeWidgetService:a,log:d,messageBuilder:c,wixCodePostMessageService:e}});